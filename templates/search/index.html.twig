{% extends 'base.html.twig' %}

{% block title %}OpenSearch{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
          integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
          crossorigin=""/>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
            integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
            crossorigin=""></script>
{% endblock %}
{% block body %}

{#{{ dump(offers.1.contact.latitude) }}#}
{#    {{ dump(offers.1.contact.longitude) }}#}
    <div id="maCarte"></div>
<br>
<div class="overflow-auto">
<div class="container">
    <div class="row">
    {% for offer in offers %}
{#{{ dump(offer.contact.longitude) }}#}
{#<div id="long{{ offer.id }}">{{ offer.contact.longitude }}</div>#}
{#<div id="lat{{ offer.id }}">{{ offer.contact.latitude }}</div>#}

                    <div class="mb-3 col-sm-6">
                        <div class="card cardHover h-100" data-lat="{{ offer.contact.latitude }}" data-long="{{ offer.contact.longitude }}">
                            <div class=" h-100 row g-0">
                                <div class=" col-lg-5">
                                    <picture>
                                        <source srcset="{{ asset("uploads/" ~ "testsearch.jpg")|imagine_filter("offer_thumb_sm") }}"
                                                media="(max-width: 576px)">
                                        <source srcset="{{ asset("uploads/" ~ "testsearch.jpg")|imagine_filter("offer_thumb_lg") }}"
                                                media="(max-width: 992px)">
                                        <source srcset="{{ asset("uploads/" ~ "testsearch.jpg")|imagine_filter("offer_thumb_xl") }}"
                                                media="(max-width: 1200px)">
                                        <source srcset="{{ asset("uploads/" ~ "testsearch.jpg")|imagine_filter("offer_thumb_xml") }}"
                                                media="(max-width: 1400px)">
                                        <source srcset="{{ asset("uploads/" ~ "testsearch.jpg")|imagine_filter("offer_thumb_xxl") }}"
                                                media="(min-width: 1400px)">
                                        <img class="img-fluid"
                                             src="{{ asset("uploads/" ~ "testsearch.jpg")|imagine_filter("offer_thumb_default") }}"
                                             alt="offer image">
                                    </picture>


                                </div>
                                <div class="col-md-8 col-lg-7">
                                    <div class="h-100 card-body">
                                        <p class="rounded p-1 bg-secondary categoryOffer text-center">category</p>
                                        <h5 class="card-title text-center">{{ offer.name }}</h5>
                                        <p class="card-text card-text-color">{{ offer.description.shortDescription }}
                                        </p>

                                        <!-- Button trigger modal -->
                                        {% set lowest_price = 10000 %}
                                        {% for offer_variation in offer.offerVariations %}
                                            {% if offer_variation.price < lowest_price %}
                                                {% set lowest_price = offer_variation.price %}
                                            {% endif %}
                                        {% endfor %}
                                        <p class="mt-auto"> A partir de <b>{{ lowest_price }}€. </b><a type="button"
                                                                                                       class="borderHover"
                                                                                                       data-bs-toggle="modal"
                                                                                                       data-bs-target="#modalDetail_{{ offer.id }}">
                                                (Détail)</a>
                                        </p>
                                        <a href="{{ path('offer_show', {'id': offer.id}) }}"
                                           class="btnOffer btn btn-primary">réserver <i
                                                    class="fas fa-shopping-cart"></i></a>
                                        <p class="card-text"><small class="text-muted"></small></p>
                                    </div>
                                    <i class="positionBotright fas fa-star"></i>
                                </div>
                            </div>
                            <!-- Modal -->
                            <div class="modal fade" id="modalDetail_{{ offer.id }}" tabindex="-1"
                                 aria-labelledby="ModalLabel_{{ offer.id }}" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="ModalLabel_{{ offer.id }}">{{ offer.name }}</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                    aria-label="Fermer"></button>
                                        </div>
                                        <div class="modal-body">
                                            <h6>Grille des tarifs</h6>
                                            <ul>

                                                {% for offer_variation in offer.offerVariations %}
                                                    {# {{ dump( offer_variation.priceVariation) }} #}
                                                    <li class="d-flex justify-content-between">
                                                        <span><b>Tarif {{ loop.index }}:</b> </span>
                                                        <span><i class="far fa-clock"></i> <b>{{ offer_variation.duration|date("h:i") }}</b></span>
                                                        <span><i class="fas fa-users"></i>{% if offer_variation.booking.totalPlaces is defined %}
                                                            {% if offer_variation.capacity - offer_variation.booking.totalPlaces == 1 %}
                                                                <span class="text-warning"> <b>{{ offer_variation.capacity - offer_variation.booking.totalPlaces }}</b> place restante</span>
                                            {% elseif offer_variation.capacity - offer_variation.booking.totalPlaces == 0 %}
                                                                <b>  <span class="text-danger">full</span></b>
                                            {% else %}
                                                                <b>{{ offer_variation.capacity - offer_variation.booking.totalPlaces }} </b>  places restantes
                                                            {% endif %}
                                                            {% else %}
                                <b>{{ offer_variation.capacity }}</b> places restantes </span>
                                                        {% endif %}
                                                    </li>
                                                    <li class="d-flex justify-content-end">
                                                        {% for key, price_dif in offer_variation.priceVariation %}
                                                            <span class="ps-5"><i
                                                                        class="fas fa-ticket-alt"></i>   {{ key }}: <b>{{ price_dif }}</b>€  </span>
                                                        {% endfor %}
                                                    </li>
                                                    <hr>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                        <div class="modal-footer">
                                            <a href="{{ path('offer_show', {'id': offer.id}) }}"
                                               class="btnOffer btn btn-primary">réserver <i
                                                        class="fas fa-shopping-cart"></i></a>
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                                Close
                                            </button>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            <!--endmodal-->
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {{ encore_entry_script_tags('map') }}
    <script>
        // //On initialise la carte
        // var carte = L.map('maCarte').setView([45.7460663, -0.6300671], 11);
        //
        // //On charge les "tuiles"
        // L.tileLayer('https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png', {
        //     minZoom: 10,
        //     maxZoom: 15,
        //     attribution: '&copy; OpenStreetMap France | &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        // }).addTo(carte);
        //
        // //on ajoute des marqueurs
        // var marqueur = L.marker([45.7460663, -0.6300671]).addTo(carte);
        //
        // //création de sa popup
        // marqueur.bindPopup("<h4>Saintes</h4>");



        // fetch(`/search/coordinate`)
        //     .then((response) => response.json())
        //     .then((data) => {
        //         console.log(data)
        //         let list = '';
        //         for (const item of data.features) {
        //             list += `<li><a href="/search/${item.properties.label}">${item.properties.label}</a></li>`;
        //         }
        //         document.getElementById('autocomplete').innerHTML = list;
        //     });
    </script>
{% endblock %}
